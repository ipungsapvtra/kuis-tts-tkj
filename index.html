<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kuis TTS - Keamanan Jaringan</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .grid-container {
            display: grid;
            /* Ukuran kolom dan baris akan diatur oleh JavaScript */
            gap: 2px;
        }
        .grid-cell {
            /* Ukuran lebar dan tinggi akan diatur oleh JavaScript */
            background-color: #1f2937; /* gray-800 */
            border: 1px solid #4b5563; /* gray-600 */
            position: relative;
        }
        .grid-cell input {
            width: 100%;
            height: 100%;
            text-align: center;
            background-color: #f3f4f6; /* gray-100 */
            border: 1px solid #d1d5db; /* gray-300 */
            color: #111827; /* gray-900 */
            text-transform: uppercase;
            font-weight: 600;
            border-radius: 4px;
            /* Ukuran font akan diatur oleh JavaScript */
        }
        .grid-cell input:focus {
            outline: none;
            border: 2px solid #3b82f6; /* blue-500 */
            background-color: #fff;
        }
        .highlight input {
            background-color: #bfdbfe; /* blue-200 */
        }
        .correct input {
             background-color: #dcfce7; /* green-100 */
             color: #166534; /* green-800 */
             border-color: #4ade80; /* green-400 */
        }
        .incorrect input {
            background-color: #fee2e2; /* red-100 */
            color: #991b1b; /* red-800 */
            border-color: #f87171; /* red-400 */
        }
    </style>
</head>
<body class="bg-gray-900 text-white flex items-center justify-center min-h-screen">

    <!-- Login/Register Screen -->
    <div id="auth-screen" class="w-full max-w-md p-8 space-y-6 bg-gray-800 rounded-xl shadow-lg mx-4">
        <div class="flex justify-center mb-4">
            <!-- GANTI 'logo.png' dengan path file logo lokal Anda -->
            <img src="logo.png" alt="Logo" class="w-24 h-24 rounded-full" onerror="this.onerror=null;this.src='https://placehold.co/100x100/3b82f6/FFFFFF?text=LOGO';">
        </div>
        <h2 class="text-3xl font-bold text-center text-white">Kuis TTS Jaringan</h2>
        <p class="text-center text-gray-400">Silakan login atau daftar untuk memulai.</p>
        <div id="auth-message" class="text-center p-2 rounded-md"></div>
        
        <!-- Login Form -->
        <form id="login-form" class="space-y-4">
            <input type="email" placeholder="Email" required class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
            <button type="submit" class="w-full px-4 py-2 font-semibold text-white bg-blue-600 rounded-md hover:bg-blue-700 transition">Login</button>
        </form>

        <!-- Register Form (hidden by default) -->
        <form id="register-form" class="hidden space-y-4">
            <input type="email" placeholder="Email" required class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
            <button type="submit" class="w-full px-4 py-2 font-semibold text-white bg-green-600 rounded-md hover:bg-green-700 transition">Daftar</button>
        </form>
        
        <p class="text-sm text-center text-gray-400">
            <a href="#" id="toggle-auth" class="font-medium text-blue-400 hover:underline">Belum punya akun? Daftar di sini.</a>
        </p>
    </div>

    <!-- Game Screen (hidden by default) -->
    <div id="game-screen" class="hidden container mx-auto p-4 lg:p-8">
        <div class="flex flex-col sm:flex-row justify-between items-center mb-4 gap-4">
            <h1 class="text-xl sm:text-2xl md:text-3xl font-bold text-center sm:text-left">Kuis Keamanan Jaringan</h1>
            <div class="flex items-center">
                <span id="user-email" class="text-gray-300 mr-4 text-sm sm:text-base"></span>
                <button id="logout-btn" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg transition text-sm sm:text-base">Logout</button>
            </div>
        </div>
        <div class="flex flex-col lg:flex-row gap-8">
            <!-- Grid -->
            <div class="flex-shrink-0 w-full lg:max-w-md mx-auto">
                <div id="grid-container" class="grid-container mx-auto"></div>
                 <div class="flex justify-center gap-4 mt-4">
                    <button id="check-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-lg transition">Cek Jawaban</button>
                    <button id="reset-btn" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-6 rounded-lg transition">Reset</button>
                </div>
            </div>
            <!-- Clues -->
            <div class="flex-grow bg-gray-800 p-6 rounded-lg">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h3 class="font-bold text-lg mb-2 border-b-2 border-blue-500 pb-1">Mendatar</h3>
                        <ul id="across-clues" class="space-y-2 text-gray-300"></ul>
                    </div>
                    <div>
                        <h3 class="font-bold text-lg mb-2 border-b-2 border-green-500 pb-1">Menurun</h3>
                        <ul id="down-clues" class="space-y-2 text-gray-300"></ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Result Modal (hidden by default) -->
    <div id="result-modal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4">
        <div class="bg-gray-800 rounded-lg shadow-xl p-8 max-w-sm w-full text-center">
            <h2 class="text-3xl font-bold mb-4">Hasil Kuis</h2>
            <p id="score-text" class="text-xl mb-6">Skor Anda: 8 dari 10!</p>
            <button id="close-modal-btn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition">Tutup</button>
        </div>
    </div>


    <script>
        // PENTING: Ganti URL ini dengan URL Web App dari Google Apps Script Anda
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbx8owZVWJ0J7SjFqUEdLZ47X6vhuIibsjgTCslQ_HNsZJK2U1g7d3TU55uAi4jQTFgR1g/exec';

        // --- Data Kuis TTS ---
        const quizData = [
            { clue: 'Alamat unik setiap perangkat di jaringan (Singkatan)', answer: 'IP', position: 1, orientation: 'across', row: 1, col: 1 },
            { clue: 'Jaringan komputer lokal (Singkatan)', answer: 'LAN', position: 4, orientation: 'across', row: 3, col: 0 },
            { clue: 'Port standar untuk layanan web tidak terenkripsi', answer: 'HTTP', position: 5, orientation: 'across', row: 4, col: 3 },
            { clue: 'Port 443 digunakan untuk layanan ini', answer: 'HTTPS', position: 7, orientation: 'across', row: 6, col: 1 },
            { clue: 'Protokol untuk transfer file, port 21', answer: 'FTP', position: 8, orientation: 'across', row: 8, col: 3 },
            { clue: 'Protokol untuk resolusi nama domain, port 53', answer: 'DNS', position: 1, orientation: 'down', row: 1, col: 1 },
            { clue: 'Perangkat yang menghubungkan beberapa jaringan', answer: 'ROUTER', position: 2, orientation: 'down', row: 1, col: 5 },
            { clue: 'Akses remote yang aman, port 22', answer: 'SSH', position: 3, orientation: 'down', row: 2, col: 3 },
            { clue: 'Layanan email untuk mengirim, port 25', answer: 'SMTP', position: 6, orientation: 'down', row: 4, col: 7 },
        ];
        
        // --- Elemen DOM ---
        const authScreen = document.getElementById('auth-screen');
        const gameScreen = document.getElementById('game-screen');
        const loginForm = document.getElementById('login-form');
        const registerForm = document.getElementById('register-form');
        const toggleAuthLink = document.getElementById('toggle-auth');
        const authMessage = document.getElementById('auth-message');
        const userEmailEl = document.getElementById('user-email');
        const logoutBtn = document.getElementById('logout-btn');

        const gridContainer = document.getElementById('grid-container');
        const acrossClues = document.getElementById('across-clues');
        const downClues = document.getElementById('down-clues');
        const checkBtn = document.getElementById('check-btn');
        const resetBtn = document.getElementById('reset-btn');
        
        const resultModal = document.getElementById('result-modal');
        const scoreText = document.getElementById('score-text');
        const closeModalBtn = document.getElementById('close-modal-btn');

        let activeWord = null;
        let inputs = {}; // { 'row-col': element }
        
        // --- Fungsi Responsif Grid ---
        function resizeGrid() {
            const gridWrapper = gridContainer.parentElement;
            if (!gridWrapper) return;

            const containerWidth = gridWrapper.offsetWidth;
            const GRID_SIZE = 10;
            const GAP = 2;

            const totalGap = GAP * (GRID_SIZE - 1);
            const cellSize = Math.floor((containerWidth - totalGap) / GRID_SIZE);

            if (cellSize <= 0) return;

            gridContainer.style.gridTemplateColumns = `repeat(${GRID_SIZE}, ${cellSize}px)`;
            gridContainer.style.gridTemplateRows = `repeat(${GRID_SIZE}, ${cellSize}px)`;
            
            const fontSize = Math.max(12, Math.floor(cellSize * 0.5));
            
            const cells = gridContainer.querySelectorAll('.grid-cell');
            cells.forEach(cell => {
                cell.style.width = `${cellSize}px`;
                cell.style.height = `${cellSize}px`;
                const input = cell.querySelector('input');
                if(input) {
                    input.style.fontSize = `${fontSize}px`;
                }
            });
        }
        
        window.addEventListener('resize', resizeGrid);

        // --- Logika Autentikasi ---
        function showMessage(message, isError = false) {
            authMessage.textContent = message;
            authMessage.className = `text-center p-2 rounded-md ${isError ? 'bg-red-200 text-red-800' : 'bg-green-200 text-green-800'}`;
        }

        toggleAuthLink.addEventListener('click', (e) => {
            e.preventDefault();
            loginForm.classList.toggle('hidden');
            registerForm.classList.toggle('hidden');
            if (loginForm.classList.contains('hidden')) {
                toggleAuthLink.textContent = 'Sudah punya akun? Login di sini.';
            } else {
                toggleAuthLink.textContent = 'Belum punya akun? Daftar di sini.';
            }
            authMessage.textContent = '';
        });

        async function handleAuth(e, action) {
            e.preventDefault();
            const form = e.target;
            const email = form.querySelector('input[type="email"]').value;
            const button = form.querySelector('button');
            const originalButtonText = button.textContent;
            
            button.disabled = true;
            button.textContent = 'Memproses...';
            showMessage('Menghubungi server...', false);

            try {
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    mode: 'cors',
                    headers: { 'Content-Type': 'text/plain' },
                    body: JSON.stringify({ action, email })
                });
                
                const result = await response.json();

                if (result.status === 'success') {
                    if (action === 'login') {
                        localStorage.setItem('ttsUser', email);
                        showGameScreen(email);
                    } else {
                        showMessage(result.message);
                    }
                } else {
                    showMessage(result.message, true);
                }
            } catch (error) {
                console.error('Error:', error);
                showMessage('Gagal terhubung ke server. Cek konsol.', true);
            } finally {
                button.disabled = false;
                button.textContent = originalButtonText;
            }
        }

        loginForm.addEventListener('submit', (e) => handleAuth(e, 'login'));
        registerForm.addEventListener('submit', (e) => handleAuth(e, 'register'));

        logoutBtn.addEventListener('click', () => {
            localStorage.removeItem('ttsUser');
            authScreen.classList.remove('hidden');
            gameScreen.classList.add('hidden');
            loginForm.reset();
            registerForm.reset();
            authMessage.textContent = '';
        });

        function showGameScreen(email) {
            authScreen.classList.add('hidden');
            gameScreen.classList.remove('hidden');
            userEmailEl.textContent = `User: ${email}`;
            // Panggil resizeGrid setelah elemen game terlihat
            // Timeout kecil untuk memastikan browser selesai me-render
            setTimeout(resizeGrid, 50);
        }


        // --- Logika Game ---
        function createGrid() {
            const GRID_SIZE = 10;
            const wordCells = new Set();
            quizData.forEach(word => {
                for (let i = 0; i < word.answer.length; i++) {
                    if (word.orientation === 'across') {
                        wordCells.add(`${word.row}-${word.col + i}`);
                    } else {
                        wordCells.add(`${word.row + i}-${word.col}`);
                    }
                }
            });

            for (let r = 0; r < GRID_SIZE; r++) {
                for (let c = 0; c < GRID_SIZE; c++) {
                    const cell = document.createElement('div');
                    cell.className = 'grid-cell';
                    if (wordCells.has(`${r}-${c}`)) {
                        const input = document.createElement('input');
                        input.type = 'text';
                        input.maxLength = 1;
                        input.dataset.row = r;
                        input.dataset.col = c;
                        
                        input.addEventListener('input', handleInput);
                        input.addEventListener('keydown', handleKeyDown);
                        input.addEventListener('focus', handleFocus);
                        
                        cell.appendChild(input);
                        inputs[`${r}-${c}`] = input;
                    }
                    gridContainer.appendChild(cell);
                }
            }
        }

        function displayClues() {
            acrossClues.innerHTML = '';
            downClues.innerHTML = '';
            quizData.forEach(word => {
                const li = document.createElement('li');
                li.innerHTML = `<span class="font-semibold cursor-pointer hover:text-blue-400">${word.position}.</span> ${word.clue}`;
                li.addEventListener('click', () => handleClueClick(word));
                if (word.orientation === 'across') {
                    acrossClues.appendChild(li);
                } else {
                    downClues.appendChild(li);
                }
            });
        }
        
        function handleClueClick(word) {
            activeWord = word;
            document.querySelectorAll('.grid-cell input').forEach(inp => inp.parentElement.classList.remove('highlight'));
            
            for(let i=0; i < word.answer.length; i++) {
                let r = word.row, c = word.col;
                if (word.orientation === 'across') c += i;
                else r += i;
                
                const inputEl = inputs[`${r}-${c}`];
                if (inputEl) {
                    inputEl.parentElement.classList.add('highlight');
                    if (i === 0) inputEl.focus();
                }
            }
        }
        
        function handleFocus(e) {
            const r = e.target.dataset.row;
            const c = e.target.dataset.col;
            const clickedWord = quizData.find(word => {
                if (word.orientation === 'across') {
                    return word.row == r && c >= word.col && c < word.col + word.answer.length;
                } else {
                    return word.col == c && r >= word.row && r < word.row + word.answer.length;
                }
            });
            if(clickedWord) handleClueClick(clickedWord);
        }

        function handleInput(e) {
            if (!activeWord) return;
            const input = e.target;
            const r = parseInt(input.dataset.row);
            const c = parseInt(input.dataset.col);

            if (input.value.length === 1) {
                let nextR = r, nextC = c;
                if (activeWord.orientation === 'across') {
                    nextC++;
                } else {
                    nextR++;
                }
                const nextInput = inputs[`${nextR}-${nextC}`];
                if (nextInput) nextInput.focus();
            }
        }
        
        function handleKeyDown(e) {
            if (e.key !== 'Backspace' || !activeWord) return;
            const input = e.target;
            if (input.value === '') {
                 const r = parseInt(input.dataset.row);
                 const c = parseInt(input.dataset.col);
                 let prevR = r, prevC = c;
                 if (activeWord.orientation === 'across') {
                    prevC--;
                 } else {
                    prevR--;
                 }
                 const prevInput = inputs[`${prevR}-${prevC}`];
                 if (prevInput) prevInput.focus();
            }
        }

        checkBtn.addEventListener('click', () => {
            let correctCount = 0;
            quizData.forEach(word => {
                let userAnswer = '';
                for(let i=0; i < word.answer.length; i++) {
                    let r = word.row, c = word.col;
                    if(word.orientation === 'across') c += i;
                    else r += i;
                    userAnswer += inputs[`${r}-${c}`]?.value || ' ';
                }
                
                const isCorrect = userAnswer.toUpperCase() === word.answer;
                if (isCorrect) correctCount++;
                
                for(let i=0; i < word.answer.length; i++) {
                    let r = word.row, c = word.col;
                    if(word.orientation === 'across') c += i;
                    else r += i;
                    const inputEl = inputs[`${r}-${c}`];
                    if (inputEl) {
                        inputEl.parentElement.classList.remove('incorrect', 'correct');
                        inputEl.parentElement.classList.add(isCorrect ? 'correct' : 'incorrect');
                    }
                }
            });
            
            scoreText.textContent = `Skor Anda: ${correctCount} dari ${quizData.length} benar!`;
            resultModal.classList.remove('hidden');
        });

        resetBtn.addEventListener('click', () => {
            Object.values(inputs).forEach(input => {
                input.value = '';
                input.parentElement.classList.remove('highlight', 'correct', 'incorrect');
            });
            activeWord = null;
        });
        
        closeModalBtn.addEventListener('click', () => {
            resultModal.classList.add('hidden');
        });
        
        // --- Inisialisasi ---
        document.addEventListener('DOMContentLoaded', () => {
            const loggedInUser = localStorage.getItem('ttsUser');
            createGrid();
            displayClues();
            if (loggedInUser) {
                showGameScreen(loggedInUser);
            }
        });

    </script>
</body>
</html>

